{
  "version": 3,
  "sources": ["../../src/lib/iobroker-objects.ts"],
  "sourcesContent": ["import type {\n\tChannelObjectDefinition,\n\tDeviceObjectDefinition,\n\tStateObjectDefinition,\n} from \"../plugins/plugin\";\nimport { Global as _ } from \"./global\";\nimport type { PeripheralInfo } from \"./scanProcessInterface\";\n\n/** Extends a device object in the ioBroker objects DB */\nexport async function extendDevice(\n\tdeviceId: string,\n\tperipheral: PeripheralInfo,\n\tobject: DeviceObjectDefinition,\n): Promise<void> {\n\tconst original = (await _.objectCache.getObject(\n\t\t`${_.adapter.namespace}.${deviceId}`,\n\t)) as ioBroker.DeviceObject | undefined;\n\t// update the object while preserving the existing properties\n\tconst updated: ioBroker.SettableObject = {\n\t\ttype: \"device\",\n\t\tcommon: {\n\t\t\tname: peripheral.advertisement.localName,\n\t\t\t...object.common,\n\t\t\t...(original && original.common),\n\t\t},\n\t\tnative: {\n\t\t\tid: peripheral.id,\n\t\t\taddress: peripheral.address,\n\t\t\taddressType: peripheral.addressType,\n\t\t\tconnectable: peripheral.connectable,\n\t\t\t...object.native,\n\t\t\t...(original && original.native),\n\t\t},\n\t};\n\n\t// check if we have to update anything\n\tif (\n\t\toriginal == null ||\n\t\tJSON.stringify(original.common) !== JSON.stringify(updated.common) ||\n\t\tJSON.stringify(original.native) !== JSON.stringify(updated.native)\n\t) {\n\t\t_.adapter.log.debug(\n\t\t\t`${\n\t\t\t\toriginal == null ? \"creating\" : \"updating\"\n\t\t\t} device object ${deviceId}`,\n\t\t);\n\t\tawait _.adapter.setObjectAsync(deviceId, updated);\n\t}\n}\n\nexport async function extendChannel(\n\tchannelId: string,\n\tobject: ChannelObjectDefinition,\n): Promise<void> {\n\tconst original = (await _.objectCache.getObject(\n\t\t`${_.adapter.namespace}.${channelId}`,\n\t)) as ioBroker.ChannelObject | undefined;\n\t// update the object while preserving the existing properties\n\tconst updated: ioBroker.SettableObject = {\n\t\ttype: \"channel\",\n\t\tcommon: {\n\t\t\tname: channelId,\n\t\t\t...object.common,\n\t\t\t...(original && original.common),\n\t\t},\n\t\tnative: {\n\t\t\t...object.native,\n\t\t\t...(original && original.native),\n\t\t},\n\t};\n\n\t// check if we have to update anything\n\tif (\n\t\toriginal == null ||\n\t\tJSON.stringify(original.common) !== JSON.stringify(updated.common) ||\n\t\tJSON.stringify(original.native) !== JSON.stringify(updated.native)\n\t) {\n\t\t_.adapter.log.debug(\n\t\t\t`${\n\t\t\t\toriginal == null ? \"creating\" : \"updating\"\n\t\t\t} channel object ${channelId}`,\n\t\t);\n\t\tawait _.adapter.setObjectAsync(channelId, updated);\n\t}\n}\n\nexport async function extendState(\n\tstateId: string,\n\tobject: StateObjectDefinition,\n): Promise<void> {\n\tconst original = (await _.objectCache.getObject(\n\t\t`${_.adapter.namespace}.${stateId}`,\n\t)) as ioBroker.StateObject | undefined;\n\t// update the object while preserving the existing properties\n\tconst updated: ioBroker.SettableObject = {\n\t\ttype: \"state\",\n\t\t// @ts-expect-error\n\t\tcommon: {\n\t\t\trole: \"state\",\n\t\t\tread: true,\n\t\t\twrite: false,\n\t\t\tname: stateId,\n\t\t\t...object.common,\n\t\t\t...(original && original.common),\n\t\t},\n\t\tnative: {\n\t\t\t...object.native,\n\t\t\t...(original && original.native),\n\t\t},\n\t};\n\n\t// check if we have to update anything\n\tif (\n\t\toriginal == null ||\n\t\tJSON.stringify(original.common) !== JSON.stringify(updated.common) ||\n\t\tJSON.stringify(original.native) !== JSON.stringify(updated.native)\n\t) {\n\t\t_.adapter.log.debug(\n\t\t\t`${\n\t\t\t\toriginal == null ? \"creating\" : \"updating\"\n\t\t\t} state object ${stateId}`,\n\t\t);\n\t\tawait _.adapter.setObjectAsync(stateId, updated);\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA,oBAA4B;AAI5B,eAAsB,aACrB,UACA,YACA,QACgB;AAChB,QAAM,WAAY,MAAM,cAAAA,OAAE,YAAY;AAAA,IACrC,GAAG,cAAAA,OAAE,QAAQ,aAAa;AAAA,EAC3B;AAEA,QAAM,UAAmC;AAAA,IACxC,MAAM;AAAA,IACN,QAAQ;AAAA,MACP,MAAM,WAAW,cAAc;AAAA,MAC/B,GAAG,OAAO;AAAA,MACV,GAAI,YAAY,SAAS;AAAA,IAC1B;AAAA,IACA,QAAQ;AAAA,MACP,IAAI,WAAW;AAAA,MACf,SAAS,WAAW;AAAA,MACpB,aAAa,WAAW;AAAA,MACxB,aAAa,WAAW;AAAA,MACxB,GAAG,OAAO;AAAA,MACV,GAAI,YAAY,SAAS;AAAA,IAC1B;AAAA,EACD;AAGA,MACC,YAAY,QACZ,KAAK,UAAU,SAAS,MAAM,MAAM,KAAK,UAAU,QAAQ,MAAM,KACjE,KAAK,UAAU,SAAS,MAAM,MAAM,KAAK,UAAU,QAAQ,MAAM,GAChE;AACD,kBAAAA,OAAE,QAAQ,IAAI;AAAA,MACb,GACC,YAAY,OAAO,aAAa,4BACf;AAAA,IACnB;AACA,UAAM,cAAAA,OAAE,QAAQ,eAAe,UAAU,OAAO;AAAA,EACjD;AACD;AAEA,eAAsB,cACrB,WACA,QACgB;AAChB,QAAM,WAAY,MAAM,cAAAA,OAAE,YAAY;AAAA,IACrC,GAAG,cAAAA,OAAE,QAAQ,aAAa;AAAA,EAC3B;AAEA,QAAM,UAAmC;AAAA,IACxC,MAAM;AAAA,IACN,QAAQ;AAAA,MACP,MAAM;AAAA,MACN,GAAG,OAAO;AAAA,MACV,GAAI,YAAY,SAAS;AAAA,IAC1B;AAAA,IACA,QAAQ;AAAA,MACP,GAAG,OAAO;AAAA,MACV,GAAI,YAAY,SAAS;AAAA,IAC1B;AAAA,EACD;AAGA,MACC,YAAY,QACZ,KAAK,UAAU,SAAS,MAAM,MAAM,KAAK,UAAU,QAAQ,MAAM,KACjE,KAAK,UAAU,SAAS,MAAM,MAAM,KAAK,UAAU,QAAQ,MAAM,GAChE;AACD,kBAAAA,OAAE,QAAQ,IAAI;AAAA,MACb,GACC,YAAY,OAAO,aAAa,6BACd;AAAA,IACpB;AACA,UAAM,cAAAA,OAAE,QAAQ,eAAe,WAAW,OAAO;AAAA,EAClD;AACD;AAEA,eAAsB,YACrB,SACA,QACgB;AAChB,QAAM,WAAY,MAAM,cAAAA,OAAE,YAAY;AAAA,IACrC,GAAG,cAAAA,OAAE,QAAQ,aAAa;AAAA,EAC3B;AAEA,QAAM,UAAmC;AAAA,IACxC,MAAM;AAAA,IAEN,QAAQ;AAAA,MACP,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,MAAM;AAAA,MACN,GAAG,OAAO;AAAA,MACV,GAAI,YAAY,SAAS;AAAA,IAC1B;AAAA,IACA,QAAQ;AAAA,MACP,GAAG,OAAO;AAAA,MACV,GAAI,YAAY,SAAS;AAAA,IAC1B;AAAA,EACD;AAGA,MACC,YAAY,QACZ,KAAK,UAAU,SAAS,MAAM,MAAM,KAAK,UAAU,QAAQ,MAAM,KACjE,KAAK,UAAU,SAAS,MAAM,MAAM,KAAK,UAAU,QAAQ,MAAM,GAChE;AACD,kBAAAA,OAAE,QAAQ,IAAI;AAAA,MACb,GACC,YAAY,OAAO,aAAa,2BAChB;AAAA,IAClB;AACA,UAAM,cAAAA,OAAE,QAAQ,eAAe,SAAS,OAAO;AAAA,EAChD;AACD;",
  "names": ["_"]
}
